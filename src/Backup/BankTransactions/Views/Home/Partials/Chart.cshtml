@using JQChart.Web.Mvc
@using nl.jorncruijsen.jbs.transactions

@model IEnumerable<BankRecord>
           
@{int tableCounter = (int)(HttpContext.Current.Items["ChartCounter"] = (HttpContext.Current.Items.Contains("ChartCounter") ? ((int)HttpContext.Current.Items["ChartCounter"]) + 1 : 0));}

@(Html.JQChart()
                .Chart(Model)
                .ID("jqChart" + tableCounter)
                .Width(750)
                .Height(600)
                .Series(series =>
                    {
                        series.Column().Title("Amount")
                                       .XValues(el => el.RequestDate)
                                       .YValues(el => (el.Type.Equals(BankRecord.TransactionType.CREDIT) ? 1 : -1) * el.Amount)
                                       .LineWidth(2);
                        series.Line().Title("Fund")
                                       .XValues(el => el.RequestDate)
                                       .YValues(el => Model.Where(r => r.RequestDate <= el.RequestDate).Sum(r => (r.Type.Equals(BankRecord.TransactionType.CREDIT) ? 1 : -1) * r.Amount))
                                       .LineWidth(2);
                    }
                )
                .Render() 
          )